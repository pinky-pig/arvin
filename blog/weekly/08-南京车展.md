---
title: ç¬¬08æœŸ - å—äº¬è½¦å±•
date: 2023/05/04
desc: é€›å—äº¬è½¦å±•~  åœ¨é—¨å£çœ‹åˆ°äº†ä¸€è¾†å¹¿å‘Šè½¦ï¼Œè¶…çº§è¶…çº§é•¿
tags: ['#Weekly']
cover: https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/imagesè¶…çº§é•¿çš„è½¦.jpg
---

[[toc]]

<p align="center">
<img alt="è¶…çº§é•¿çš„è½¦" src="https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/imagesè¶…çº§é•¿çš„è½¦.jpg" width=800 />
</p>

## æŠ€æœ¯ç›¸å…³

**Rain Shader**

ä¸Šå‘¨çœ‹åˆ°çš„ [Three.js Rain](https://github.com/rocksdanister/rain) çš„ä¾‹å­ï¼Œåœ¨ windows ä¸Šè¿è¡Œçš„æ—¶å€™ï¼Œå‘ç°å¾ˆæ­£å¸¸ã€‚ä½†æ˜¯è¿™å‘¨åœ¨ Mac ä¸Šè¿è¡Œçš„æ—¶å€™ï¼Œå‘ç°é›¨æ»´çš„åƒç´ æ„Ÿå¾ˆä¸¥é‡ã€‚

é¦–å…ˆä¸çŸ¥é“æ˜¯å“ªé‡Œçš„é—®é¢˜ï¼Œå› ä¸º Three.js ä¹Ÿä¸ç†Ÿï¼ŒShader ä¹Ÿä¸ç†Ÿï¼Œä½†å¯ä»¥è‚¯å®šé—®é¢˜å°±å‡ºç°åœ¨è¿™é‡Œã€‚

ç„¶å Google ä¸€ä¸‹ï¼Œåœ¨ Three.js çš„è®ºå›æ‰¾åˆ°äº†ä¸€ä¸ªç›¸å…³å¸–å­ [Threejs Rain Shader](https://discourse.threejs.org/t/looking-for-rain-effect/29121/3)ã€‚

è¿›è€Œå‘ç°äº† [shadertoy](https://www.shadertoy.com/) ä¸Šæœ‰å¾ˆå¤šå‰å®³çš„ shader æ•ˆæœï¼Œ

å…¶ä¸­ [é›¨æ»´æ•ˆæœ](https://www.shadertoy.com/view/ltffzl) æ„Ÿè§‰å¾ˆéœ‡æ’¼ï¼Œå¼€å¯äº†æ–°å¤§é™†ã€‚

å°† Shadertoy çš„ä»£ç æ‹·è´åˆ° Vscode ï¼Œä¸‹è½½äº† `stevensona.shader-toy` æ’ä»¶ï¼Œç„¶åå°±å¯ä»¥åœ¨ vscode ä¸­è¿è¡Œé¢„è§ˆ shader ä»£ç äº†ï¼Œæ•ˆæœä¹Ÿæ˜¯å¾ˆå¥½ã€‚ä¸è¿‡å¦‚æœä»£ç ä¸­æœ‰ `iChannel0` è¿™æ ·çš„å˜é‡ï¼Œå°±éœ€è¦è‡ªå·±å»æ·»åŠ å®šä¹‰ä»£ç å¹¶æ·»åŠ å›¾ç‰‡åœ°å€ã€‚

**æ‹–æ‹½æ’åº**

ä¾ç„¶æ˜¯åšäº†å¾ˆå¤šéçš„æ‹–æ‹½æ’åºï¼Œè¿™æ¬¡çš„ç›®çš„å¾ˆç®€å•ï¼Œå®ç°æ‹–æ‹½æ’åºçš„æ—¶å€™ï¼Œç¢°æ’å…ƒç´ çš„æ—¶å€™ï¼Œæ’å…¥å…¶ä¸­ï¼Œè¢«ç¢°æ’çš„å…ƒç´ å¾€åæ’åºæˆ–è€…å¾€å‰æ’åºã€‚

æ€è·¯ä¹Ÿæ˜¯ä¸€å¦‚æ—¢å¾€çš„ç®€å•ã€‚

1. é¦–å…ˆç›’å­å’Œå­å…ƒç´ çˆ¶ç›¸å­ç»ï¼Œç„¶åè®¾ç½® Transform çš„ `translate` ã€‚
2. è®¾ç½®å˜é‡ `mouseFrom` å’Œ `mouseTo` ï¼Œåˆ†åˆ«è®°å½•é¼ æ ‡ç§»åŠ¨å‰å’Œç§»åŠ¨åçš„ä½ç½®ã€‚ç„¶åè®¡ç®— `mouseTo` å’Œ `mouseFrom` çš„å·®å€¼ï¼Œå°±æ˜¯é¼ æ ‡ç§»åŠ¨çš„è·ç¦»ã€‚è¿™æ ·å¯ä»¥ä¿è¯å…ƒç´ ç§»åŠ¨çš„è·ç¦»æ¯”è¾ƒå¹³æ»‘ã€‚
3. è®¾ç½® `placeholder` ï¼Œå°±æ˜¯å½“å‰æ‹–æ‹½å…ƒç´ çš„å ä½ï¼Œ å…¶ä½ç½®å°±æ˜¯å½“å‰æ‹–æ‹½å…ƒç´ çš„ä½ç½®çš„ `Math.round` å€¼ã€‚
4. ç¢°æ’æ£€æµ‹ï¼Œè¿™é‡Œå°±æ˜¯æ‹–æ‹½æ¯ä¸€æ­¥*mousemove*éƒ½éœ€è¦è¿è¡Œæ£€æµ‹ï¼Œæ‹¿å½“å‰çš„å…ƒç´ ä¸æ‰€æœ‰å…ƒç´ ç›¸æ¯”åˆ¤æ–­ã€‚

```ts
allNodes.forEach((n: ElemensBoxType, index: number) => {
  if (!node.id.startsWith(n.id) && checkHit(node, n))
    hittedNodes.push(n)
})
function checkHit(a: ElemensBoxType, b: ElemensBoxType) {
  return (
    a.x < b.x + b.width
    && a.x + a.width > b.x
    && a.y < b.y + b.height
    && a.y + a.height > b.y
  )
}
```

5. æ¥ä¸‹æ¥å°±æ˜¯æ’å…¥ï¼Œç„¶åå…¶ä½™å…ƒç´ é¡ºåºå¾€åæ’ã€‚æ€è·¯å°±æ˜¯å…ˆå°†å½“å‰å…ƒç´ ä»æ•°ç»„ä¸­å–å‡ºæ¥ï¼Œç„¶åæ’å…¥ï¼Œåœ¨å°†æ‰€æœ‰å…ƒç´ éå†ä¸€éé‡æ–°è®¾ç½®ä½ç½®ã€‚

```ts
hittedNodes.forEach((n: ElemensBoxType) => {
  // æ¯”è¾ƒå½“å‰ç‚¹å‡»çš„è¿™ä¸ªå€¼ hitIndex ï¼Œè·Ÿç¢°æ’åˆ°çš„å…ƒç´ çš„ nIndex
  // 1. è¦æ˜¯å°äº hitIndex < nIndex ï¼Œå°±æ’åˆ°ç¢°æ’çš„å€¼çš„åé¢
  // 2. è¦æ˜¯å¤§äº hitIndex > nIndex ï¼Œå°±æ’åˆ°ç¢°æ’çš„å€¼çš„å‰é¢
  const hitIndex = allNodes.findIndex(item => item.id === currentClickedBox.value.id)
  const nIndex = allNodes.findIndex(item => item.id === n.id)
  if (hitIndex < nIndex) {
    const origin = elementsBox.value.splice(hitIndex, 1)[0]
    elementsBox.value.splice(nIndex, 0, origin)
  }
  else {
    const origin = elementsBox.value.splice(hitIndex, 1)[0]
    elementsBox.value.splice(nIndex, 0, origin)
  }

  elementsBox.value.forEach((item: ElemensBoxType, index: number) => {
    if (item.id !== currentClickedBox.value.id) {
      const row = Math.floor(index / maximumInLine)
      const column = index % maximumInLine
      item.x = column * (size + gap)
      item.y = row * (size + gap)
    }
  })
})
```

<https://www.notion.so/caeaf582e3c74713953870ce7bf6402b?pvs=4>

## ç”Ÿæ´»ç›¸å…³

è¿™å‘¨å»äº†å—äº¬è½¦å±•ï¼Œå¤´ä¸€æ¬¡å»è½¦å±•ï¼Œåˆšå¼€å§‹è¿˜æ„Ÿè§‰æœ‰ç‚¹æ–°å¥‡ï¼Œåˆ°åé¢å°±è§‰å¾—æ²¡å•¥æ„æ€äº†ã€‚ä¸´èµ°çš„æ—¶å€™æœ‰æŠ½å¥–ï¼Œæˆ‘å’Œæ˜¥æ˜¥ä¸€äººæŠ½ä¸­ä¸€ä¸ªé©¬å…‹æ¯ï¼Œä¸å’‹å¥½çœ‹ï¼Œä½†ä¹Ÿå¾ˆå¼€å¿ƒğŸ˜†ã€‚

![è½¦å±•](https://cdn.jsdelivr.net/gh/pinky-pig/pic-bed/imagesè½¦å±•.jpg)

å»è½¦å±•çš„ç›®çš„ï¼Œä¸»è¦ä¹Ÿæ˜¯æ˜¥æ˜¥æƒ³ä¹°ä¸€è¾†è½¦ï¼Œç„¶åå°±å»çœ‹çœ‹ï¼Œçœ‹çœ‹æœ‰æ²¡æœ‰åˆé€‚çš„ã€‚æˆ‘ä¹‹å‰çœ‹äº†å‰åˆ©çš„æ˜Ÿè¶ŠLï¼Œæ„Ÿè§‰è¿˜ä¸é”™ï¼Œè¿™æ¬¡ä¹Ÿå»çœ‹çœ‹ã€‚ç„¶ååœ¨äº”ä¸€å‡æœŸçš„æœ€åä¸¤å¤©ï¼Œå»äº†å—äº¬çš„å‰åˆ© 4s åº—ï¼Œç ç ä»·æ ¼ï¼Œä½†è¿˜æ˜¯æ²¡ç ä¸‹æ¥ï¼Œè¿˜æ˜¯è¶…å‡ºäº†é¢„ç®—ï¼Œæœ€åä¹Ÿæ²¡æœ‰ä¹°ã€‚

æœ€åçš„ä¸¤å¤©ï¼Œåˆæ„Ÿå†’äº†ã€‚ã€‚ã€‚æ–°å† å¤é˜³ä¹Ÿä¸Šäº†çƒ­æœï¼Œè¿˜æ˜¯æœ‰ç‚¹æ‹…å¿ƒï¼Œä¸æƒ³å†é­ä¸€æ¬¡ç½ªäº†ã€‚
